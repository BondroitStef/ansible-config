---
- name: Raise dick.
  hosts: dick
  user: root


  roles:
    - common
    - sshkeys
    - role: router
      tags: router
    - role: sshtunnel
      sshtunnel_remote_host: adams
      sshtunnel_remote_url: adams.ugent.be
      sshtunnel_forwards:
        # Kerberos
        - local_port: 88
          remote_port: 88
        - local_port: 543
          remote_port: 543
        - local_port: 544
          remote_port: 544
        - local_port: 749
          remote_port: 749
        - local_port: 754
          remote_port: 754

      tags: sshtunnel
    - role: kerberos_client
      kerberos_client_kdc: 127.0.0.1
      kerberos_client_kadmin: 127.0.0.1
      tags: kerberos_client

    - role: ufw_rule
      ufw_applications:
        - name: "WWW Full"
        - name: "DNS"
      ufw_rules:
        # DHCP
        - rule: allow
          port: "67:68"
          proto: udp
      ufw_ssh_ports:
        - 22
        - 2222
        - 2223
      ufw_nat: true
      ufw_ipv6: false
      ufw_nat_local_network: "10.0.0.0/24"
      ufw_nat_uplink_device: "enp2s0"
      ufw_nat_forwards:
        # Redirect port 2223 to fles's ssh port
        - port: "2223"
          proto: tcp
          dest: "10.0.0.9"
      tags: ufw

  vars_files:
    - vars/firewall_rules.yml
